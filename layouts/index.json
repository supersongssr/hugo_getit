{{- if .Site.Params.search -}}
    {{- $index := slice -}}
    {{- $pages := .Site.RegularPages -}}
    {{- if .Site.Params.page.hiddenFromSearch -}}
        {{- $pages = where $pages "Params.hiddenfromsearch" false -}}
    {{- else -}}
        {{- $pages = where $pages "Params.hiddenfromsearch" "!=" true -}}
    {{- end -}}
    {{- range $pages -}}
        {{- $uri := .RelPermalink -}}
        {{- if $.Site.Params.search.absoluteURL -}}
            {{- $uri = .Permalink -}}
        {{- end -}}
        {{- $meta := dict "uri" $uri "title" .Title -}}
        {{- $meta = $.Site.Params.dateFormat | default "2006-01-02" | .PublishDate.Format | dict "date" | merge $meta -}}
        {{- $one := dict "content" ""| merge $meta -}}
        {{- $index = $index | append $one -}}
    {{- end -}}
    {{- $index | jsonify | safeJS -}}
{{- end -}}
